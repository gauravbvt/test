<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="all" name="Session Module">

  <target name="init">
    <taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties" classpath="${basedir}/aspectjtools.jar" />

    <property environment="env" />
    <property file="./version.properties" />
    <xmlproperty file="../pom.xml" />
    <property name="app" value="${project.artifactId}" />
    <property name="version" value="${project.version}" />
    <echo message="Building: ${app} version ${version}" />
    <property name="base" value=".." />
    <property name="src" value="${base}/modules/${app}" />
    <property name="dst" value="${basedir}/bin" />
    <property name="dist.dir" value="../../dist" />
    <property name="maven.repo.local" value="${user.home}/.m2/repository" />
    <path id="build.classpath">
      <fileset id="build.classpath.files" dir="${maven.repo.local}">
        <include name="com/beanview/beanview/1.1.2/beanview-1.1.2.jar" />
        <include name="org/springframework/spring-web/1.2.8/spring-web-1.2.8.jar" />
        <include name="org/springframework/spring-support/1.2.8/spring-support-1.2.8.jar" />
        <include name="echo2/echo2_webcontainer/2.1.0b5/echo2_webcontainer-2.1.0b5.jar" />
        <include name="commons-lang/commons-lang/2.1/commons-lang-2.1.jar" />
        <include name="logkit/logkit/1.0.1/logkit-1.0.1.jar" />
        <include name="commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar" />
        <include name="commons-collections/commons-collections/3.1/commons-collections-3.1.jar" />
        <include name="org/springframework/spring-remoting/1.2.8/spring-remoting-1.2.8.jar" />
        <include name="avalon-framework/avalon-framework/4.1.3/avalon-framework-4.1.3.jar" />
        <include name="oro/oro/2.0.8/oro-2.0.8.jar" />
        <include name="commons-digester/commons-digester/1.6/commons-digester-1.6.jar" />
        <include name="echo2/echo2_app/2.1.0b5/echo2_app-2.1.0b5.jar" />
        <include name="org/springframework/spring-jdbc/1.2.8/spring-jdbc-1.2.8.jar" />
        <include name="org/springframework/spring-core/2.0-m4/spring-core-2.0-m4.jar" />
        <include name="commons-validator/commons-validator/1.3.0/commons-validator-1.3.0.jar" />
        <include name="org/springframework/spring-aop/1.2.7/spring-aop-1.2.7.jar" />
        <include name="org/springframework/spring-dao/1.2.8/spring-dao-1.2.8.jar" />
        <include name="org/acegisecurity/acegi-security-tiger/1.0.3/acegi-security-tiger-1.0.3.jar" />
        <include name="commons-codec/commons-codec/1.3/commons-codec-1.3.jar" />
        <include name="commons-logging/commons-logging/1.1/commons-logging-1.1.jar" />
        <include name="org/ho/jyaml/jyaml-lib/1.0-beta-3/jyaml-lib-1.0-beta-3.jar" />
        <include name="echo2/echo2_webrender/2.1.0b5/echo2_webrender-2.1.0b5.jar" />
        <include name="aspectj/aspectjrt/1.5.3/aspectjrt-1.5.3.jar" />
        <include name="log4j/log4j/1.2.9/log4j-1.2.9.jar" />
        <include name="umlgraph/umlgraph/4.8/umlgraph-4.8.jar" />
        <include name="org/springframework/spring-context/1.2.8/spring-context-1.2.8.jar" />
        <include name="org/springframework/spring-beans/2.0-m4/spring-beans-2.0-m4.jar" />
        <include name="org/springframework/spring-webmvc/1.2.8/spring-webmvc-1.2.8.jar" />
        <include name="xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.jar" />
        <include name="org/acegisecurity/acegi-security/1.0.3/acegi-security-1.0.3.jar" />
      </fileset>
    </path>
  </target>

  <target name="compile.check" depends="init">
  	<uptodate property="compile.notneeded" targetfile="${dist.dir}/${app}-${version}.jar">
  		<srcfiles dir="${src}">
		    <include name="**/*"/>
  		</srcfiles>
  	</uptodate>
  </target>
	
  <target name="compile" depends="compile.check" unless="compile.notneeded">
  	<iajc classpathref="build.classpath" srcdir="${src}" destdir="${dst}" source="1.5"/>
  </target>
	
  <target name="jar" depends="init,compile">
    <copy todir="${dst}">
      <filterset begintoken="$${" endtoken="}">
        <filter token="project.name" value="${project.name}" />
        <filter token="project.version" value="${project.version}" />
        <filter token="project.description" value="${project.description}" />
      </filterset>
      <fileset dir="../modules/mod-model">
        <exclude name="**/*.java" />
        <exclude name="**/*.aj" />
        <exclude name="**/package.html" />
      </fileset>
    </copy>
    <copy todir="${dst}/lib">
      <mapper type="flatten" />
      <fileset refid="build.classpath.files" />
    </copy>
    <jar basedir="${dst}" compress="true" destfile="${dist.dir}/${app}-${version}.jar">
      <include name="**/*" />
      <exclude name="**/.nbattrs*" />
      <exclude name="**/.svn" />
      <exclude name="**/*.java" />
    </jar>
  </target>

  <target depends="init,clean,jar" description="Build everything." name="all">
    <echo message="${app}  built." />
  </target>

  <target depends="init" description="Clean all build products." name="clean">
    <delete file="${dist.dir}/${app}-${version}.jar" />
    <delete dir="${dst}" />
  </target>

  <target name="test-offline">
    <condition property="maven.mode.offline">
      <equals arg1="${build.sysclasspath}" arg2="only" />
    </condition>
  </target>

  <target name="get-deps" depends="test-offline" description="Download all dependencies" unless="maven.mode.offline">
    <mkdir dir="${maven.repo.local}" />
    <get src="http://repo1.maven.org/maven2/com/beanview/beanview/1.1.2/beanview-1.1.2.jar"
      dest="${maven.repo.local}/com/beanview/beanview/1.1.2/beanview-1.1.2.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-web/1.2.8/spring-web-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-web/1.2.8/spring-web-1.2.8.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-support/1.2.8/spring-support-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-support/1.2.8/spring-support-1.2.8.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/echo2/echo2_webcontainer/2.1.0b5/echo2_webcontainer-2.1.0b5.jar"
      dest="${maven.repo.local}/echo2/echo2_webcontainer/2.1.0b5/echo2_webcontainer-2.1.0b5.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-lang/commons-lang/2.1/commons-lang-2.1.jar"
      dest="${maven.repo.local}/commons-lang/commons-lang/2.1/commons-lang-2.1.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/logkit/logkit/1.0.1/logkit-1.0.1.jar"
      dest="${maven.repo.local}/logkit/logkit/1.0.1/logkit-1.0.1.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar"
      dest="${maven.repo.local}/commons-beanutils/commons-beanutils/1.7.0/commons-beanutils-1.7.0.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-collections/commons-collections/3.1/commons-collections-3.1.jar"
      dest="${maven.repo.local}/commons-collections/commons-collections/3.1/commons-collections-3.1.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-remoting/1.2.8/spring-remoting-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-remoting/1.2.8/spring-remoting-1.2.8.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/avalon-framework/avalon-framework/4.1.3/avalon-framework-4.1.3.jar"
      dest="${maven.repo.local}/avalon-framework/avalon-framework/4.1.3/avalon-framework-4.1.3.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/oro/oro/2.0.8/oro-2.0.8.jar" dest="${maven.repo.local}/oro/oro/2.0.8/oro-2.0.8.jar"
      usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-digester/commons-digester/1.6/commons-digester-1.6.jar"
      dest="${maven.repo.local}/commons-digester/commons-digester/1.6/commons-digester-1.6.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/echo2/echo2_app/2.1.0b5/echo2_app-2.1.0b5.jar"
      dest="${maven.repo.local}/echo2/echo2_app/2.1.0b5/echo2_app-2.1.0b5.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-jdbc/1.2.8/spring-jdbc-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-jdbc/1.2.8/spring-jdbc-1.2.8.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-core/2.0-m4/spring-core-2.0-m4.jar"
      dest="${maven.repo.local}/org/springframework/spring-core/2.0-m4/spring-core-2.0-m4.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-validator/commons-validator/1.3.0/commons-validator-1.3.0.jar"
      dest="${maven.repo.local}/commons-validator/commons-validator/1.3.0/commons-validator-1.3.0.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-aop/1.2.7/spring-aop-1.2.7.jar"
      dest="${maven.repo.local}/org/springframework/spring-aop/1.2.7/spring-aop-1.2.7.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-dao/1.2.8/spring-dao-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-dao/1.2.8/spring-dao-1.2.8.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/acegisecurity/acegi-security-tiger/1.0.3/acegi-security-tiger-1.0.3.jar"
      dest="${maven.repo.local}/org/acegisecurity/acegi-security-tiger/1.0.3/acegi-security-tiger-1.0.3.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-codec/commons-codec/1.3/commons-codec-1.3.jar"
      dest="${maven.repo.local}/commons-codec/commons-codec/1.3/commons-codec-1.3.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/commons-logging/commons-logging/1.1/commons-logging-1.1.jar"
      dest="${maven.repo.local}/commons-logging/commons-logging/1.1/commons-logging-1.1.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/ho/jyaml/jyaml-lib/1.0-beta-3/jyaml-lib-1.0-beta-3.jar"
      dest="${maven.repo.local}/org/ho/jyaml/jyaml-lib/1.0-beta-3/jyaml-lib-1.0-beta-3.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/echo2/echo2_webrender/2.1.0b5/echo2_webrender-2.1.0b5.jar"
      dest="${maven.repo.local}/echo2/echo2_webrender/2.1.0b5/echo2_webrender-2.1.0b5.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/aspectj/aspectjrt/1.5.3/aspectjrt-1.5.3.jar"
      dest="${maven.repo.local}/aspectj/aspectjrt/1.5.3/aspectjrt-1.5.3.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/log4j/log4j/1.2.9/log4j-1.2.9.jar"
      dest="${maven.repo.local}/log4j/log4j/1.2.9/log4j-1.2.9.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/umlgraph/umlgraph/4.8/umlgraph-4.8.jar"
      dest="${maven.repo.local}/umlgraph/umlgraph/4.8/umlgraph-4.8.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-context/1.2.8/spring-context-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-context/1.2.8/spring-context-1.2.8.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-beans/2.0-m4/spring-beans-2.0-m4.jar"
      dest="${maven.repo.local}/org/springframework/spring-beans/2.0-m4/spring-beans-2.0-m4.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/springframework/spring-webmvc/1.2.8/spring-webmvc-1.2.8.jar"
      dest="${maven.repo.local}/org/springframework/spring-webmvc/1.2.8/spring-webmvc-1.2.8.jar" usetimestamp="true"
      ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.jar"
      dest="${maven.repo.local}/xml-apis/xml-apis/1.0.b2/xml-apis-1.0.b2.jar" usetimestamp="true" ignoreerrors="true" />
    <get src="http://repo1.maven.org/maven2/org/acegisecurity/acegi-security/1.0.3/acegi-security-1.0.3.jar"
      dest="${maven.repo.local}/org/acegisecurity/acegi-security/1.0.3/acegi-security-1.0.3.jar" usetimestamp="true"
      ignoreerrors="true" />
  </target>
</project>
