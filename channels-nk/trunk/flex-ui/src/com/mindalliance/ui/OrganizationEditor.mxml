<?xml version="1.0" encoding="utf-8"?>
<mx:Form xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:mas="com.mindalliance.ui.*">
    
    <mx:Script>
        <![CDATA[
            import mx.events.DataGridEvent;
            import mx.controls.listClasses.ListData;
            import mx.events.ListEvent;
            import mx.managers.PopUpManager;
            import mx.events.CloseEvent;
            private function handleClose(event:CloseEvent):void {
                PopUpManager.removePopUp(this) ;
            }
            
            private var so:SearchOrganization ;
            private function btnSearchParentOrganizationClicked(event:MouseEvent):void {
                so = SearchOrganization(PopUpManager.createPopUp(btnSearchParentOrganization, SearchOrganization)) ;
                var p:Point = btnSearchParentOrganization.localToGlobal(new Point(btnSearchParentOrganization.x, btnSearchParentOrganization.y)) ;
                so.x = p.x ;
                so.y = p.y ;
                so.title = "Choose Parent Organization" ;
                so.organizationSelectionHandler = function(item:Object):void {selectedOrganization = item;} ;
                so.disciplineSelectionHandler = function(item:Object):void {selectedDiscipline = item;} ;
                so.addEventListener(CloseEvent.CLOSE, parentOrganizationChooserClose) ;
            }
            
            private var selectedDiscipline:Object ;
            private var selectedOrganization:Object ;
            private function parentOrganizationChooserClose(event:CloseEvent):void {
                txtParentOrganization.text = selectedOrganization.toString() ;
            }
            
            private function dgMissionsItemClicked(event:DataGridEvent):void {
                if (event.columnIndex == 0)
                    return ;
                if (event.columnIndex == 1)
                    event.preventDefault();
                var cc:CategoryChooser = CategoryChooser(PopUpManager.createPopUp(dgMissions, CategoryChooser, false));
                cc.x = dgMissions.mouseX ;
                cc.y = dgMissions.mouseY ;
                //TODO fill in category chooser with categories from the item being edited
            }
            
        ]]>
    </mx:Script>

    <mx:FormItem label="Name">
        <mx:TextInput id="txtName"/>
    </mx:FormItem>
    <mx:FormItem label="Description">
        <mx:TextArea id="txtDescription"/>
    </mx:FormItem>
    <mx:FormItem label="Categories">
        <mx:VBox width="100%" height="100%">
            <mx:DataGrid id="dgCategories" click="btnSetAddRemoveItem.itemClickHandler(event)">
                <mx:columns>
                    <mx:DataGridColumn headerText="Discipline"/>
                    <mx:DataGridColumn headerText="Name"/>
                </mx:columns>
            </mx:DataGrid>
            <mas:ItemAddRemoveButtonSet id="btnSetAddRemoveItem"/>
        </mx:VBox>
    </mx:FormItem>
    <mx:FormItem label="Normally Operational">
        <mx:CheckBox/>
    </mx:FormItem>
    <mx:FormItem label="Parent Organization">
        <mx:HBox width="100%">
            <mx:TextInput width="100%" id="txtParentOrganization"/>
            <mx:Image source="assets/data_find.png" width="24" height="24" scaleContent="true" id="btnSearchParentOrganization" click="btnSearchParentOrganizationClicked(event)"/>
        </mx:HBox>
    </mx:FormItem>
    <mx:FormItem label="Location">
        <mx:TextInput/>
    </mx:FormItem>
    <mx:FormItem label="Jurisdiction">
        <mx:TextInput/>
    </mx:FormItem>
    <mx:FormItem label="Missions">
        <mx:VBox width="100%" height="100%" creationPolicy="all">
            <mx:DataGrid id="dgMissions" click="btnSetAddRemoveMission.itemClickHandler(dgMissions.selectedItem)" itemEditBeginning="dgMissionsItemClicked(event)">
                <mx:columns>
                    <mx:DataGridColumn headerText="Description"/>
                    <mx:DataGridColumn headerText="Categories" editable="false"/>
                </mx:columns>
            </mx:DataGrid>
            <mas:ItemAddRemoveButtonSet id="btnSetAddRemoveMission"/>
        </mx:VBox>
    </mx:FormItem>
</mx:Form>