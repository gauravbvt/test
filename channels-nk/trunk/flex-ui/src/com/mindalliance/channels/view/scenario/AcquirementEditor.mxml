<?xml version="1.0" encoding="utf-8"?>
<mx:Box xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:common="com.mindalliance.channels.view.common.*" xmlns:categories="com.mindalliance.channels.view.categories.*">

	<mx:Script>
		<![CDATA[
			import com.mindalliance.channels.events.scenario.UpdateArtifactEvent;
			import com.mindalliance.channels.events.scenario.GetAcquirementEvent;
            import com.mindalliance.channels.vo.common.TopicVO;
            import mx.collections.ArrayCollection;
            import mx.managers.PopUpManager;
            import com.mindalliance.channels.events.resources.*;
            import com.mindalliance.channels.events.common.*;
            
            import com.mindalliance.channels.view.common.InputTextDialog;
            import com.mindalliance.channels.model.EditorModel;
            import com.adobe.cairngorm.control.CairngormEventDispatcher;
            import com.mindalliance.channels.vo.common.ElementVO;
            import com.mindalliance.channels.vo.AcquirementVO;
            import com.mindalliance.channels.model.ChannelsModelLocator;
            import com.mindalliance.channels.model.ElementModel;
            import com.mindalliance.channels.util.CairngormHelper;
            
            [Bindable]
            public var model : EditorModel = ChannelsModelLocator.getInstance().getEditorModel();
            
            [Bindable]
            private var elementModel : ElementModel;
            
            [Bindable]
            private var organizationList : ArrayCollection;

            [Bindable]
            private var edited : AcquirementVO;
            
            private function switchToEditState():void {
                currentState = 'EditState' ;
            }
            
            private function confirmEdit():void {
                update();
                currentState = '' ;
            }
            
            private function cancelEdit():void {
                // Revert
                 CairngormHelper.fireEvent( new GetAcquirementEvent(model.id,model));
                currentState = '' ;
            }
            
            private function update() :void {
                
                CairngormHelper.fireEvent( new UpdateAcquirementEvent(model,
                                                                txtName.text,
                                                                txtDescription.text,
                                                                (elementModel.data as AcquirementVO).categories,
                                                                (elementModel.data as AcquirementVO).product));   
            }
            
            private function queueUpdate() : void {
                CairngormHelper.queueUpdate(model);
            }
            
            
            private function init() : void {}
		]]>
	</mx:Script>
	<mx:Binding source="model.getElementModel(model.id)" destination="elementModel"/>
    <mx:Binding source="(elementModel.data as AcquirementVO)" destination="edited"/>
    <mx:Binding source="edited.categories" destination="categoryViewer.model.categories"/>

	<mx:states>
		<mx:State name="EditState">
			<mx:SetProperty target="{txtName}" name="editable" value="true"/>
			<mx:SetProperty target="{txtDescription}" name="editable" value="true"/>
			<mx:SetProperty target="{categoryViewer}" name="currentState" value="EditState"/>
			<mx:SetProperty target="{vieweditstatechangeformitem}" name="currentState" value="EditState"/>
		</mx:State>
	</mx:states>
	
	<mx:transitions>
		<common:ViewEditStateTransition fromState="*" toState="*" targets="{[formitemCategories]}"/>
	</mx:transitions>
	
	<mx:Style source="../../../../../assets/styles/FormStyles.css"/> 
	
	<mx:Form>
	
		<common:ViewEditStateChangeFormItem
			btnEditClickHandler="{switchToEditState}" cancelEditHandler="{cancelEdit}" confirmEditHandler="{confirmEdit}" 
			width="100%" id="vieweditstatechangeformitem"/>
		<mx:FormItem label="Acquirement Name" direction="vertical" id="formitemName">
			<mx:TextInput id="txtName" editable="false" styleName="PrimaryNameFieldEditState" text="{edited.name}" change="{queueUpdate()}"/>
		</mx:FormItem>
		<mx:FormItem label="Description">
			<mx:TextArea id="txtDescription" wordWrap="true" editable="false" text="{edited.description}" change="{queueUpdate()}"/>
		</mx:FormItem>
		<mx:FormItem label="Categories" id="formitemCategories" width="100%">
            <categories:CategoryViewer id="categoryViewer" change="{queueUpdate()}"/>
		</mx:FormItem>
		
	</mx:Form>
	
</mx:Box>
