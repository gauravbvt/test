<?xml version="1.0" encoding="utf-8"?>
<mx:TabNavigator xmlns:mx="http://www.adobe.com/2006/mxml"
	xmlns:scenario="com.mindalliance.channels.view.scenario.*"
	xmlns:people="com.mindalliance.channels.view.people.*"
	creationComplete="init()"
    width="100%" height="100%">

	<mx:Script>
		<![CDATA[
			import mx.binding.utils.BindingUtils;
			import com.mindalliance.channels.vo.RoleVO;
			import com.mindalliance.channels.events.scenario.GetTaskEvent;
			import com.mindalliance.channels.util.CairngormHelper;
			import com.mindalliance.channels.model.ChannelsModelLocator;
			import com.mindalliance.channels.model.application.TaskNodeEditorModel;
			import mx.controls.Alert;
			import mx.events.StateChangeEvent;
		
            private var model : TaskNodeEditorModel = ChannelsModelLocator.getInstance().propertyEditorModel.taskNodeEditorModel;
		
			private function init():void {
				taskEditor.model = model.taskModel;
				roleEditor.model = model.roleModel;
				BindingUtils.bindSetter(setState, taskEditor, ['currentState']) ;
				BindingUtils.bindSetter(setState, roleEditor, ['currentState']) ;
			}
			
			[Bindable]
			public var editorState:String ;
			
			[Bindable]
			private var _taskID:String ;
			
			[Bindable]
			private var _roleID:String ;
			
			private function setState(value:Object):void {
				if (taskEditor.currentState == 'EditState' || roleEditor.currentState == 'EditState')
					editorState = 'EditState' ;
				else
					editorState = '' ;
			}
			
			public function loadTask(taskID:String):void {
				var event:GetTaskEvent = new GetTaskEvent(taskID, taskEditor.model) ;
				CairngormHelper.fireEvent(event) ;
			}
		
		]]>
	</mx:Script>
	
	<mx:Binding source="taskEditor.model.id" destination="_taskID"/>
	<mx:Binding source="(ChannelsModelLocator.getInstance().getElementListModel('agents'+_taskID).data.getItemAt(0) as RoleVO).id" destination="_roleID"/>
	
	<scenario:TaskEditor id="taskEditor" label="{'Task: '}" enabled="{roleEditor.currentState != 'EditState'}" width="100%" height="100%"/>
	<people:RoleEditor id="roleEditor" label="{'Role: '}" enabled="{(_roleID != null) &amp;&amp; (taskEditor.currentState != 'EditState')}" width="100%" height="100%"/>
</mx:TabNavigator>