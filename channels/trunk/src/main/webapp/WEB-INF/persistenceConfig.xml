<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd">

    <bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
        <property name="configLocation" value="/WEB-INF/ehcache.xml"/>
    </bean>

    <bean id="resultCache" class="com.mindalliance.channels.query.ResultCache">
        <property name="cacheKey" value="results"/>
        <property name="cacheManager" ref="cacheManager"/>
    </bean>

    <bean id="cacheSet" class="com.mindalliance.channels.query.CacheAdvice">
        <property name="cache" ref="resultCache"/>
    </bean>

    <bean id="cacheClear" class="com.mindalliance.channels.query.CacheResetAdvice">
        <property name="cache" ref="resultCache"/>
    </bean>

    <bean id="permCache" class="com.mindalliance.channels.query.ResultCache">
        <property name="cacheKey" value="longTerm"/>
        <property name="cacheManager" ref="cacheManager"/>
    </bean>

    <bean id="permSet" class="com.mindalliance.channels.query.CacheAdvice">
        <property name="cache" ref="permCache"/>
    </bean>
    <bean id="permClear" class="com.mindalliance.channels.query.CacheResetAdvice">
        <property name="cache" ref="permCache"/>
    </bean>

    <aop:config proxy-target-class="true">
        <!-- Temporary caching refreshed when model is changed -->
        <aop:advisor pointcut="execution(java.util.List com.mindalliance.channels.QueryService.*(..))"
                     advice-ref="cacheSet"/>
        <aop:advisor pointcut="execution(java.util.List com.mindalliance.channels.Detective.*(..))"
                     advice-ref="cacheSet"/>
        <aop:advisor pointcut="execution(String com.mindalliance.channels.Analyst.*(..))"
                     advice-ref="cacheSet"/>
        <aop:advisor pointcut="execution(Boolean com.mindalliance.channels.Analyst.*(..))"
                     advice-ref="cacheSet"/>
        <aop:advisor pointcut="execution(Integer com.mindalliance.channels.Analyst.*(..))"
                     advice-ref="cacheSet"/>
        <aop:advisor pointcut="execution(com.mindalliance.channels.graph.Diagram com.mindalliance.channels.DiagramFactory.*(..))"
                     advice-ref="cacheSet"/>
        <!-- Permanent caching -->
        <aop:advisor pointcut="execution(String com.mindalliance.channels.GeoService.getGeoCoding(..))"
                     advice-ref="permSet"/>
        <aop:advisor pointcut="execution(java.util.List com.mindalliance.channels.GeoService.findNearbyPostalCodes(..))"
                     advice-ref="permSet"/>
        <aop:advisor pointcut="execution(Boolean com.mindalliance.channels.GeoService.verifyPostalCode(..))"
                     advice-ref="permSet"/>
        <aop:advisor pointcut="execution(Boolean com.mindalliance.channels.GeoService.isPostalCodeInGeoLocation(..))"
                     advice-ref="permSet"/>
        <aop:advisor pointcut="execution(Boolean com.mindalliance.channels.GeoService.isLikelyGeoname(..))"
                      advice-ref="permSet"/>
        <aop:advisor pointcut="execution(java.util.List com.mindalliance.channels.GeoService.findGeoLocations(..))"
                       advice-ref="permSet"/>
        <aop:advisor pointcut="execution(Boolean com.mindalliance.channels.SemanticMatcher.matches(..))"
                     advice-ref="permSet"/>
        <aop:advisor pointcut="execution(com.mindalliance.channels.nlp.Proximity com.mindalliance.channels.SemanticMatcher.semanticProximity(..))"
                      advice-ref="permSet"/>
        <aop:advisor pointcut="execution(Double com.mindalliance.channels.SemanticMatcher.assessSimilarity(..))"
                       advice-ref="permSet"/>
        <aop:advisor pointcut="execution(net.didion.jwnl.data.IndexWord com.mindalliance.channels.SemanticMatcher.lookupBaseForm(..))"
                       advice-ref="permSet"/>
        <!-- Temporary caching trigger -->
        <aop:advisor pointcut="execution(* com.mindalliance.channels.dao.PlanManager.onAfterCommand(..))"
                     advice-ref="cacheClear"/>
    </aop:config>

    <!-- Transmission media -->
    <bean id="phone" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Phone"/>
         <property name="kind" value="Type"/>
         <property name="addressPattern" value="(\d*\D*\d{3}\D*\d{3}\D*\d{4}(\s*\D+\s*\d+)?)|(\d{3})"/>
         <property name="cast" value="Unicast"/>
     </bean>
     <bean id="landline" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Landline"/>
         <property name="kind" value="Type"/>
         <property name="tags">
             <list value-type="java.util.ArrayList">
                 <ref bean="phone"/>
             </list>
         </property>
         <property name="cast" value="Unicast"/>
     </bean>
     <bean id="fax" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Fax"/>
         <property name="kind" value="Type"/>
         <property name="tags">
             <list value-type="java.util.ArrayList">
                 <ref bean="phone"/>
             </list>
         </property>
         <property name="cast" value="Unicast"/>
     </bean>
     <bean id="cell" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Cell"/>
         <property name="kind" value="Type"/>
         <property name="tags">
             <list value-type="java.util.ArrayList">
                 <ref bean="phone"/>
             </list>
         </property>
         <property name="cast" value="Unicast"/>
     </bean>
    <bean id="pager" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Pager"/>
        <property name="kind" value="Type"/>
        <property name="tags">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
            </list>
        </property>
        <property name="cast" value="Unicast"/>
    </bean>
     <bean id="conferenceCall" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Conference call"/>
         <property name="addressPattern" value="\d*\D*\d{3}\D*\d{3}\D*\d{4}"/>
         <property name="cast" value="Multicast"/>
         <property name="delegatedToMedia">
             <list value-type="java.util.ArrayList">
                 <ref bean="phone"/>
             </list>
         </property>
     </bean>
     <bean id="email" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Email"/>
         <property name="kind" value="Type"/>
         <property name="addressPattern" value="[^@\s]+@[^@\s]+\.\w+"/>
         <property name="cast" value="Unicast"/>
     </bean>
     <bean id="notificationSystem" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="Notification system"/>
         <property name="kind" value="Type"/>
         <property name="addressPattern" value=".+"/>
         <property name="cast" value="Multicast"/>
         <property name="delegatedToMedia">
             <list value-type="java.util.ArrayList">
                 <ref bean="phone"/>
                 <ref bean="email"/>
                 <ref bean="im"/>
             </list>
         </property>
     </bean>
     <bean id="im" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="IM"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".+"/>
         <property name="cast" value="Unicast"/>
      </bean>
     <bean id="radio" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="Radio"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".+"/>
         <property name="cast" value="Broadcast"/>
      </bean>
     <bean id="television" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="Television"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".+"/>
         <property name="cast" value="Broadcast"/>
      </bean>
     <bean id="courier" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="Courier"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".+"/>
          <property name="cast" value="Unicast"/>
       </bean>
     <bean id="mail" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="Mail"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".+"/>
         <property name="cast" value="Unicast"/>
      </bean>
     <bean id="faceToFace" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="Face to face"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".*"/>
         <property name="cast" value="Unicast"/>
          <property name="direct" value="true"/>
      </bean>
     <bean id="meeting" class="com.mindalliance.channels.model.TransmissionMedium">
          <property name="name" value="Meeting"/>
          <property name="kind" value="Type"/>
          <property name="addressPattern" value=".+"/>
         <property name="cast" value="Multicast"/>
      </bean>
    <bean id="paSystem" class="com.mindalliance.channels.model.TransmissionMedium">
         <property name="name" value="PA System"/>
         <property name="kind" value="Type"/>
         <property name="addressPattern" value=".+"/>
        <property name="cast" value="Broadcast"/>
     </bean>

    <bean id="planManager" class="com.mindalliance.channels.dao.PlanManager">
        <property name="idGenerator" ref="idGenerator"/>
        <property name="importExportFactory" ref="serializer"/>
        <property name="importDirectory" value="file:${user.home}/channels/import"/>
        <property name="planDefinitionsFileName" value="channels/plans.properties"/>
        <property name="defaultPlanDefinitions" value="/WEB-INF/plans.properties"/>
        <property name="surveysFileName" value="surveys"/>
        <property name="uploadsDirName" value="uploads"/>
        <property name="dataDirectory" value="file:${user.home}/channels/data"/>
        <property name="snapshotThreshold" value="10"/>
        <property name="builtInMedia">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
                <ref bean="landline"/>
                <ref bean="fax"/>
                <ref bean="cell"/>
                <ref bean="pager"/>
                <ref bean="conferenceCall"/>
                <ref bean="email"/>
                <ref bean="notificationSystem"/>
                <ref bean="im"/>
                <ref bean="radio"/>
                <ref bean="television"/>
                <ref bean="courier"/>
                <ref bean="mail"/>
                <ref bean="faceToFace"/>
                <ref bean="meeting"/>
                <ref bean="paSystem"/>
            </list>
        </property>
    </bean>

</beans>
