<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd">

    <bean id="semanticMatcher" class="com.mindalliance.channels.nlp.WordnetSemanticMatcher">
        <property name="wordnetDict" value="WEB-INF/data/wordnet-2/dict"/>
        <property name="simIndex" value="WEB-INF/data/jwsl/wn_index"/>
    </bean>

    <bean id="queryService" class="com.mindalliance.channels.query.DefaultQueryService">
        <constructor-arg ref="planManager"/>
        <constructor-arg ref="attachmentManager"/>
        <property name="semanticMatcher" ref="semanticMatcher"/>
    </bean>

    <bean id="serializer" class="com.mindalliance.channels.export.xml.XmlStreamer">
        <constructor-arg ref="idGenerator"/>
        <property name="version" value="1.0"/>
    </bean>

    <bean id="attachmentManager" class="com.mindalliance.channels.attachments.FileBasedManager"
          init-method="start" destroy-method="stop">
        <property name="directory" value="file:${user.home}/channels/uploads"/>
        <property name="path" value="uploads/"/>
    </bean>

    <bean id="geoService" class="com.mindalliance.channels.geo.DefaultGeoService">
        <property name="googleMapsAPIKey"
                  value="ABQIAAAAOEFNCNhUR4YjTHX0nnN5VRR4EqRj3RNZnoYuzojShxUjcPQKRRSLJekGZYEI4kGxmTTJBHr4EJ6Xpg"/>
    </bean>

    <bean id="idGenerator" class="com.mindalliance.channels.dao.PerPlanIdGenerator"/>

    <!--<bean id="idGenerator" class="com.mindalliance.channels.dao.SimpleIdGenerator"/>-->

    <bean id="imagingService" class="com.mindalliance.channels.imaging.DefaultImagingService">
        <property name="directory" value="file:${user.home}/channels/uploads"/>
        <property name="path" value="uploads/"/>
    </bean>

    <!-- setup wicket application -->
    <bean id="wicketApplication" class="com.mindalliance.channels.Channels">
        <property name="geoService" ref="geoService"/>
        <property name="importExportFactory" ref="serializer"/>
        <property name="analyst" ref="analyst"/>
        <property name="queryService" ref="queryService"/>
    </bean>

    <!-- Flow diagram factory : a prototype -->
    <bean id="diagramFactory" class="com.mindalliance.channels.graph.DefaultDiagramFactory" scope="prototype">
        <property name="graphRenderer" ref="graphvizRenderer"/>
        <property name="imageDirectory" value="WEB-INF/images"/>
        <property name="queryService" ref="queryService"/>
    </bean>

    <bean id="graphvizRenderer" class="com.mindalliance.channels.graph.GraphvizRenderer">
        <property name="dotPath" value="/usr/bin"/>
        <property name="algo" value="dot"/>
        <property name="timeout" value="10000"/>
    </bean>

    <bean id="issueScanner" class="com.mindalliance.channels.analysis.IssueScanner">
        <property name="planManager" ref="planManager"/>
        <property name="queryService" ref="queryService"/>
        <property name="analyst" ref="analyst"/>
    </bean>

    <!-- Scenario analyst -->
    <bean id="analyst" class="com.mindalliance.channels.analysis.DefaultAnalyst"
          init-method="start" destroy-method="stop">
        <property name="queryService" ref="queryService"/>
        <property name="issueDetectors">
            <list value-type="java.util.ArrayList">
                <bean class="com.mindalliance.channels.analysis.detectors.FromUser">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.NoScenarioRepondsToIncident">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.ScenarioWithoutManagedRisk">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.StartedOrTerminatedPartWithoutTask">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithoutRole">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithRoleButNoOrganization">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowWithoutChannel">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.InvalidChannel">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UnnamedFlow">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowWithUndefinedSource">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowWithUndefinedTarget">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithInvalidTiming">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.OrphanedPart">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.RedundantPart">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.RedundantFlow">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UnconnectedConnector">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowViolatesPolicy">
                    <property name="attachmentManager" ref="attachmentManager"/>
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UnconfirmedJob">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowToSelf">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.GeonameButNoLocation">
                    <property name="geoService" ref="geoService"/>
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithRoleWithNoKnownActor">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.ScenarioEventNeverEnds">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.TriggeredButNeverStartedDefinedTask">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.NeverTriggeredSpecifiedTask">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.AutoStartPartAlsoTriggered">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.ScenarioEventNeverStarts">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.ScenarioEventNotStarted">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.CyclicTriggering">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.NoRedundancy">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PotentialDeadlock">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.ActorNotInOneOrganization">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.ScenarioWithSameRisk">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UselessPart">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UnverifiedPostalCode">
                    <property name="geoService" ref="geoService"/>
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PlaceInheritsDifferentPostalCode">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PlaceInheritsDifferentStreetAddress">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PlaceContainedInSelf">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.RedundantPlace">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.EmptyNeedOrCapability">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UnsatisfiedNeed">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.PersonInSystemRole">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.CommitmentWithoutRequiredAgreement">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UntimelyTriggeringCommitment">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UntimelyCriticalCommitment">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.InconsistentImpactOnTargetPart">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.InconsistentImpactOnSourcePart">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.SinglePointOfFailure">
                    <property name="queryService" ref="queryService"/>
                </bean>
                <bean class="com.mindalliance.channels.analysis.detectors.UserIsManyActors">
                    <property name="queryService" ref="queryService"/>
                </bean>
            </list>
        </property>
    </bean>

    <!-- Lock manager -->
    <bean id="lockManager" class="com.mindalliance.channels.command.DefaultLockManager" scope="prototype">
        <property name="queryService" ref="queryService"/>
    </bean>

    <!-- Commander -->
    <bean id="commander" class="com.mindalliance.channels.command.DefaultCommander" scope="prototype">
        <property name="timeout" value="300"/>
        <property name="queryService" ref="queryService"/>
        <property name="analyst" ref="analyst"/>
        <property name="lockManager" ref="lockManager"/>
    </bean>

</beans>
