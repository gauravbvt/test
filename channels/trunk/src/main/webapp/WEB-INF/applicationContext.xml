<?xml version="1.0" encoding="UTF-8"?>
<!--

CONFIGURATION NOTES:

  For new Channels server instances,, see comments prefaced with NOTE:

-->
<beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xmlns:aop="http://www.springframework.org/schema/aop"
        xmlns:sec="http://www.springframework.org/schema/security"
        xmlns:context="http://www.springframework.org/schema/context"

        xsi:schemaLocation="
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
            http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd

            http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.0.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd"

        default-autowire="byName">

    <!-- =========================== Main Components -->
    <bean id="wicketApplication" class="com.mindalliance.channels.Channels"/>
    <bean id="idGenerator" class="com.mindalliance.channels.dao.PerPlanIdGenerator"/>
    <bean id="issueScanner" class="com.mindalliance.channels.analysis.IssueScanner"/>

    <bean id="planManager" class="com.mindalliance.channels.dao.PlanManager">
        <property name="base" value="${channels.home}"/>
        <property name="importDirectory" value="file:${channels.home}/import"/>
        <property name="planDefinitionsFileName" value="plans.properties"/>
        <property name="defaultPlanDefinitions" value="/WEB-INF/plans.properties"/>
        <property name="surveysFileName" value="surveys"/>
        <property name="uploadsDirName" value="uploads"/>
        <property name="dataDirectory" value="file:${channels.home}/data"/>
        <property name="snapshotThreshold" value="10"/>
        <property name="builtInMedia">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
                <ref bean="landline"/>
                <ref bean="fax"/>
                <ref bean="cell"/>
                <ref bean="pager"/>
                <ref bean="conferenceCall"/>
                <ref bean="email"/>
                <ref bean="notificationSystem"/>
                <ref bean="im"/>
                <ref bean="radio"/>
                <ref bean="television"/>
                <ref bean="courier"/>
                <ref bean="mail"/>
                <ref bean="faceToFace"/>
                <ref bean="meeting"/>
                <ref bean="paSystem"/>
            </list>
        </property>
    </bean>

    <bean id="attachmentManager" class="com.mindalliance.channels.attachments.FileBasedManager">
        <property name="uploadPath" value="uploads/"/>
    </bean>

    <bean id="queryService" class="com.mindalliance.channels.query.DefaultQueryService">
        <constructor-arg ref="planManager"/>
        <constructor-arg ref="attachmentManager"/>
    </bean>

    <bean id="graphRenderer" class="com.mindalliance.channels.graph.GraphvizRenderer">
        <property name="dotPath" value="/usr/bin"/>
        <property name="algo" value="dot"/>
        <property name="timeout" value="10000"/>
    </bean>

    <bean id="analyst" class="com.mindalliance.channels.analysis.DefaultAnalyst"
          init-method="start" destroy-method="stop"/>

    <bean id="imagingService" class="com.mindalliance.channels.imaging.DefaultImagingService">
        <property name="iconDirectory" value="file:${channels.home}/icons"/>
        <property name="iconPath" value="icons/"/>
    </bean>

    <bean id="importExportFactory" class="com.mindalliance.channels.export.xml.XmlStreamer">
        <constructor-arg ref="idGenerator"/>
        <property name="version" value="1.0"/>
    </bean>

    <bean id="semanticMatcher" class="com.mindalliance.channels.nlp.WordnetSemanticMatcher">
    <!--  NOTE:
              For WINDOWS installation,  use
            <property name="wordnetDict" value="WEB-INF\data\windows-wordnet-2\dict"/>
            <property name="simIndex" value="WEB-INF\data\jwsl\wn_index"/>
        -->
        <property name="wordnetDict" value="WEB-INF${file.separator}data${file.separator}wordnet-2${file.separator}dict"/>
        <property name="simIndex" value="WEB-INF${file.separator}data${file.separator}jwsl${file.separator}wn_index"/>
    </bean>

   <bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean">
        <property name="velocityProperties">
            <value>
                resource.loader=file
                file.resource.loader.class=org.apache.velocity.runtime.resource.loader.FileResourceLoader
                file.resource.loader.path=${channels.home}/templates
                file.resource.loader.cache=true
                file.resource.loader.modificationCheckInterval=2
            </value>
        </property>
    </bean>

    <bean id="detective" class="com.mindalliance.channels.analysis.DefaultDetective">
        <property name="issueDetectors">
            <list value-type="java.util.ArrayList">
                <bean class="com.mindalliance.channels.analysis.detectors.FromUser"/>
                <bean class="com.mindalliance.channels.analysis.detectors.NoSegmentRespondsToIncident"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SegmentWithoutGoal"/>
                <bean class="com.mindalliance.channels.analysis.detectors.StartedOrTerminatedPartWithoutTask"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithoutRole"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithActorOrRoleButNoOrganization"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowWithoutChannel"/>
                <bean class="com.mindalliance.channels.analysis.detectors.InvalidChannel"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UnnamedFlow"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowWithUndefinedSource"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowWithUndefinedTarget"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithInvalidTiming"/>
                <bean class="com.mindalliance.channels.analysis.detectors.OrphanedPart"/>
                <bean class="com.mindalliance.channels.analysis.detectors.RedundantPart"/>
                <bean class="com.mindalliance.channels.analysis.detectors.RedundantFlow"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UnconnectedConnector"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowViolatesPolicy"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UnconfirmedJob"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowToSelf"/>
                <bean class="com.mindalliance.channels.analysis.detectors.GeonameButNoLocation"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PartWithRoleWithNoKnownActor"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SegmentNeverEnds"/>
                <bean class="com.mindalliance.channels.analysis.detectors.TriggeredButNeverStartedDefinedTask"/>
                <bean class="com.mindalliance.channels.analysis.detectors.NeverTriggeredSpecifiedTask"/>
                <bean class="com.mindalliance.channels.analysis.detectors.AutoStartPartAlsoTriggered"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SegmentEventNeverCaused"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SegmentNeverStarts"/>
                <bean class="com.mindalliance.channels.analysis.detectors.CyclicTriggering"/>
                <bean class="com.mindalliance.channels.analysis.detectors.NoRedundancy"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PotentialDeadlock"/>
                <bean class="com.mindalliance.channels.analysis.detectors.ActorNotInOneOrganization"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SegmentWithSameGoal"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UselessPart"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UnverifiedPostalCode"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PlaceInheritsDifferentPostalCode"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PlaceInheritsDifferentStreetAddress"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PlaceContainedInSelf"/>
                <bean class="com.mindalliance.channels.analysis.detectors.RedundantPlace"/>
                <bean class="com.mindalliance.channels.analysis.detectors.EmptyNeedOrCapability"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UnsatisfiedNeed"/>
                <bean class="com.mindalliance.channels.analysis.detectors.PersonInSystemRole"/>
                <bean class="com.mindalliance.channels.analysis.detectors.CommitmentWithoutRequiredAgreement"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UntimelyTriggeringSharing"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UntimelyCriticalSharing"/>
                <bean class="com.mindalliance.channels.analysis.detectors.InconsistentImpactOnTargetPart"/>
                <bean class="com.mindalliance.channels.analysis.detectors.InconsistentImpactOnSourcePart"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SinglePointOfFailure"/>
                <bean class="com.mindalliance.channels.analysis.detectors.NonParticipatingNormalUser"/>
                <bean class="com.mindalliance.channels.analysis.detectors.NoSegmentForEventPhase"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UnplayedPart"/>
                <bean class="com.mindalliance.channels.analysis.detectors.UselessActor"/>
                <bean class="com.mindalliance.channels.analysis.detectors.InvalidEntityTyping"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowDeclassifies"/>
                <bean class="com.mindalliance.channels.analysis.detectors.SharingWithoutCommitments"/>
                <bean class="com.mindalliance.channels.analysis.detectors.InsufficientClearance"/>
                <bean class="com.mindalliance.channels.analysis.detectors.AgreementWithoutCommitment"/>
                <bean class="com.mindalliance.channels.analysis.detectors.AgreementEncompassedByOther"/>
                <bean class="com.mindalliance.channels.analysis.detectors.MediumWithoutMode"/>
                <bean class="com.mindalliance.channels.analysis.detectors.CommittmentWithoutRequiredUnicastChannel"/>
                <bean class="com.mindalliance.channels.analysis.detectors.CommittmentOverUnsecuredChannel"/>
                <bean class="com.mindalliance.channels.analysis.detectors.FlowOverUndersecuredMedium"/>
                <bean class="com.mindalliance.channels.analysis.detectors.BroadcastOnlyChannels"/>
                <bean class="com.mindalliance.channels.analysis.detectors.IncorrectMediumDelegation"/>
            </list>
        </property>
    </bean>

    <!-- =========================== Prototypes -->
    <bean id="diagramFactory" class="com.mindalliance.channels.graph.DefaultDiagramFactory"
          scope="prototype">
        <property name="imageDirectory" value="WEB-INF/images"/>
    </bean>

    <bean id="lockManager" class="com.mindalliance.channels.command.DefaultLockManager"
          scope="prototype"/>

    <bean id="commander" class="com.mindalliance.channels.command.DefaultCommander"
          scope="prototype">
        <property name="timeout" value="300"/>
    </bean>

    <!-- =========================== Transmission Media -->
    <bean id="phone" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Phone"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern"
                  value="(\d*\D*\d{3}\D*\d{3}\D*\d{4}(\s*\D+\s*\d+)?)|(\d{3})"/>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="landline" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Landline"/>
        <property name="kind" value="Type"/>
        <property name="tags">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
            </list>
        </property>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="fax" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Fax"/>
        <property name="kind" value="Type"/>
        <property name="tags">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
            </list>
        </property>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="cell" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Cell"/>
        <property name="kind" value="Type"/>
        <property name="tags">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
            </list>
        </property>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="pager" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Pager"/>
        <property name="kind" value="Type"/>
        <property name="tags">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
            </list>
        </property>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="conferenceCall" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Conference call"/>
        <property name="addressPattern" value="\d*\D*\d{3}\D*\d{3}\D*\d{4}"/>
        <property name="cast" value="Multicast"/>
        <property name="delegatedToMedia">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
            </list>
        </property>
    </bean>
    <bean id="email" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Email"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value="[^@\s]+@[^@\s]+\.\w+"/>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="notificationSystem" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Notification system"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Multicast"/>
        <property name="delegatedToMedia">
            <list value-type="java.util.ArrayList">
                <ref bean="phone"/>
                <ref bean="email"/>
                <ref bean="im"/>
            </list>
        </property>
    </bean>
    <bean id="im" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="IM"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="radio" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Radio"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Broadcast"/>
    </bean>
    <bean id="television" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Television"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Broadcast"/>
    </bean>
    <bean id="courier" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Courier"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="mail" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Mail"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Unicast"/>
    </bean>
    <bean id="faceToFace" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Face to face"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".*"/>
        <property name="cast" value="Unicast"/>
        <property name="direct" value="true"/>
    </bean>
    <bean id="meeting" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="Meeting"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Multicast"/>
    </bean>
    <bean id="paSystem" class="com.mindalliance.channels.model.TransmissionMedium">
        <property name="name" value="PA System"/>
        <property name="kind" value="Type"/>
        <property name="addressPattern" value=".+"/>
        <property name="cast" value="Broadcast"/>
    </bean>

</beans>
